---
- name: Deploy TODO Application
  hosts: todo_server
  become: true
  gather_facts: true

  vars:
    app_dir: /opt/devops-app
    compose_file: docker-compose.yml
    domain: "kolawole.chickenkiller.com"
    acme_email: "kolawole.chickenkiller@gmail.com"
    jwt_secret: "myfancysecret"
    app_repo: "https://github.com/okekolawolesunday009/DevOps-Stage-6.git"

  pre_tasks:
  - name: Update apt cache
    apt:
      update_cache: yes
      cache_valid_time: 3600

  - name: Wait for system to be ready
    wait_for_connection:
      timeout: 300

  roles:
  - dependencies
  - deploy

  post_tasks:
  - name: Display deployment information
    debug:
      msg:
      - "âœ… Deployment completed successfully!"
      - "Server IP: {{ ansible_default_ipv4.address }}"
      - "Application URL: https://kolawole.chickenkiller.com"
      - "SSH: ssh -i ~/.ssh/id_rsa ubuntu@{{ ansible_default_ipv4.address }}"
